[//]: # "Copyright Amazon.com Inc. or its affiliates. All Rights Reserved."
[//]: # "SPDX-License-Identifier: CC-BY-SA-4.0"

# Decryption Manifest

## Version

1.0.0

## Dependencies

This serves as a reference of all features that this feature depends on.

| Feature                                  | Min Version | Max Version |
| ---------------------------------------- | ----------- | ----------- |
| [keys-description](./key-description.md) | 1           | n/a         |
| [keys-manifest](./keys-manifest.md)      | 1           | n/a         |

## Summary

The decrypt manifest describes static test vectors.
This includes all the necessary details such as keyrings, cmm, encryption context, algorithm suite, etc.

## Out of Scope

This file is not a description of how the test vectors that will be generated by a compatible client should be decrypted.

## Motivation

We need a way of describing all scenarios that we want to cover with test vectors.
This will be used for generating test vectors with an unknown implementation
to be tested for compatibility using a known correct implementation.
It will also help us reason about the correctness of specific features or keyrings.
It can also be used to ensure known bad vectors or incorrect configuration cannot lead to successful decryption
by demonstrating that different configurations succeed or fail correctly.

## Guide-level Explanation

This type of manifest describes test vectors to create.
Processing these test scenarios will result in [encryption materials](../structures.md#encryption-materials).

Each test scenario includes all necessary instructions to construct
a [decryption materials request](../cmm-interface.md#decryption-materials-request).
This includes all necessary inputs including algorithm suite, encryption context, and keyrings/CMMs.

## Reference-level Explanation

### Manifest

Map identifying the manifest.

- `type` : Identifies the manifest as an AWS Encryption SDK message encryption manifest.
  - MUST be `aws-mpl-encrypt`
- `version` : Identifies the version of this feature document that describes the manifest.

#### Keys

URI identifying a [keys manifest](./keys-manifest.md) to use with all tests.

### Tests

Map object mapping a test case ID to a test case description
that describes how to generate an [encryption materials request](../cmm-interface.md#encryption-materials-request).
Optional members on [encryption materials request](../cmm-interface.md#encryption-materials-request)
are optional in the test.

- type : The type of test
  - Allowed Values
    - positive-keyring : A successful request for encrypt materials that should also result in a successful decrypt
    - negative-decrypt-keyring: A successful request for encrypt materials that should result in a failure to decrypt
- description : A human readable decryption of what is being tested

- algorithmSuiteId : Hex string of supported [Algorithm ID](../algorithm-suites.md#algorithm-suite-id)
- commitmentPolicy :
- encryptedDataKeys :
- encryptionContext : Map of keys and values to use for encryption context
- keyDescription : The [key description](./key-description.md) used in the decrypt test for this test
- reproducedEncryptionContext : The reproducedEncryptionContext to use in the decrypt test for this test
- errorDescription : The description of the expected encrypt error for a `negative-decrypt-keyring` test
- expectedResult : A structure to store the expected result for a successful `positive-keyring` test.
  - plaintextDataKey : The expected plaintext data key
  - symmetricSigningKey : The expected symmetric signing key
  - requiredEncryptionContextKeys : The expected required encryption context keys

### Examples

```json

```
