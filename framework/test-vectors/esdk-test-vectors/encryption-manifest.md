[//]: # "Copyright Amazon.com Inc. or its affiliates. All Rights Reserved."
[//]: # "SPDX-License-Identifier: CC-BY-SA-4.0"

# Encrypt Manifest

## Version

1.0.0

## Dependencies

This serves as a reference of all features that this feature depends on.

| Feature                                         | Min Version | Max Version |
| ----------------------------------------------- | ----------- | ----------- |
| [keys-description](./key-description.md)        | 1           | n/a         |
| [keys-manifest](./keys-manifest.md)             | 1           | n/a         |
| [encryption-manifest](../mpl-test-vectors/encryption-manifest.md) | 1           | n/a         |

## Summary

The encrypt manifest describes static test vectors.
This include all the necessary details such as keyring, cmm, encryption context,
algorithm suite, frame size, commitment policy, plaintext, etc.

## Out of scope

This file is not a description of how the test vectors that will be generated by a compatible client should be decrypted.

## Motivation

We need a way of describing all scenarios that we want to cover with test vectors.
This will be used for generating test vectors with an unknown implementation
to be tested for compatibility using a known correct implementation.
It will also help us reason about the correctness of specific features or keyrings
by demonstrating that different configurations succeed or fail correctly.

## Guide-level Explanation

This type of manifest describes test vectors to create.
Processing these test scenarios will result in a [Encrypted Message](../../../client-apis/encrypt.md#encrypted-message).

Each encryption test scenario includes all necessary instructions to construct a
[encrypt input request](../../../client-apis/encrypt.md#input).
This includes all necessary inputs including algorithm suite, encryption context, frame size, commitment policy.

## Reference-level Explanation

### Manifest

Map identifying the manifest.

- `type` : Identifies the manifest as an AWS Encryption SDK message encryption manifest.
  - MUST be `awses-encrypt`
- `version` : Identifies the version of this feature document that describes the manifest.

### Client

Map identifying the client
- `name`: Identifies the client that produced this AWS Encryption SDK message encryption manifest.
  - MUST begin with `aws-encryption-sdk`
  - MUST be suffixed with the runtime language that produced the encryption manifest
- `version`: Identifies the version of the client that produced the encryption manifest.

### Keys

URI identifying a [keys manifest](./keys-manifest.md) to use with all tests.

### Plaintexts

Map identifying the plaintext sizes supported in this manifest.

These values MUST correspond to the [representative plaintext constraints](./esdk-test-vector-enumeration.md#representative-plaintext-constraints)

### Tests

Map object mapping a test case ID to a test case description
that describes how to generate an [encrypt input request](../../../client-apis/encrypt.md#input).
Optional members on [encrypt input request](../../../client-apis/encrypt.md#input)
are optional in the test.

- encryption-scenario : Encryption test vector description
  - type : The type of test
    - Allowed values
      - positive-esdk : A successful request for encrypt input request that should also result in a successful decrypt request
      - negative-encrypt-esdk : A encrypt request that should fail
  - plaintext : The plaintext size to use for this encryption scenario
  - description : A human readable description of what is being tested
  - algorithmSuiteId: : Hex string of supported [Algorithm ID](../../algorithm-suites.md#algorithm-suite-id)
  - frame-size: The frame size to use for this encryption-scenario
  - encryptKeyDescription : A [key description](../mpl-test-vectors/key-description.md) used to request encrypt materials
    This value will only exist types `positive-esdk` and `negative-decrypt-esdk` because these encrypt materials are expected to succeed
- encryption-context: Map of keys and values to use for encryption context
- reproduced-encryption-context: The reproduced encryption context to use in the decryption-scenario

### Examples

```json
{
  "tests": {
    "d3e3d9f0-7ef7-4a3b-8e4a-f6ac9e2eda79": {
      "encryption-scenario": {
        "type": "positive-esdk",
        "plaintext": "small",
        "description": "Generated Discovery KMS MRK us-east-1-mrk->Filter aws 658956600833",
        "algorithmSuiteId": "0014",
        "frame-size": 512,
        "encryptKeyDescription": {
          "type": "aws-kms-mrk-aware",
          "key": "us-east-1-mrk"
        },
        "decryptKeyDescription": {
          "type": "aws-kms-mrk-aware-discovery",
          "default-mrk-region": "us-west-2",
          "aws-kms-discovery-filter": {
            "partition": "aws",
            "account-ids": [
              "658956600833"
            ]
          }
        },
        "encryption-context": {},
        "reproduced-encryption-context": {}
      }
    },
    "65f83d70-c35b-4c50-8b29-3003177d3012": {
      "encryption-scenario": {
        "type": "positive-esdk",
        "plaintext": "small",
        "description": "Success testing requiredEncryptionContextKeys/reproducedEncryptionContext",
        "algorithmSuiteId": "0478",
        "frame-size": 512,
        "encryptKeyDescription": {
          "type": "required-encryption-context-cmm",
          "underlying": {
            "type": "raw",
            "key": "aes-256",
            "provider-id": "aws-raw-vectors-persistent-aes-256",
            "encryption-algorithm": "aes"
          },
          "requiredEncryptionContextKeys": [
            "b"
          ]
        },
        "decryptKeyDescription": {
          "type": "required-encryption-context-cmm",
          "underlying": {
            "type": "raw",
            "key": "aes-256",
            "provider-id": "aws-raw-vectors-persistent-aes-256",
            "encryption-algorithm": "aes"
          },
          "requiredEncryptionContextKeys": [
            "b"
          ]
        },
        "encryption-context": {
          "a": "a",
          "b": "b"
        },
        "reproduced-encryption-context": {
          "a": "a",
          "b": "b"
        }
      }
    },
    "0b12c4b4-8a52-41b2-8e03-0a14ebf28e6f": {
      "encryption-scenario": {
        "type": "positive-esdk",
        "plaintext": "small",
        "description": "AWS KMS ECDH Discovery us-west-2-256-ecc discovery",
        "algorithmSuiteId": "0214",
        "frame-size": 512,
        "encryptKeyDescription": {
          "type": "aws-kms-ecdh",
          "sender": "us-west-2-256-ecc",
          "recipient": "us-west-2-256-ecc",
          "sender-public-key": "sender-material-public-key",
          "recipient-public-key": "recipient-material-public-key",
          "ecc-curve": "us-west-2-256-ecc",
          "schema": "static"
        },
        "decryptKeyDescription": {
          "type": "aws-kms-ecdh",
          "sender": "discovery",
          "recipient": "us-west-2-256-ecc",
          "sender-public-key": "discovery",
          "recipient-public-key": "recipient-material-public-key",
          "ecc-curve": "us-west-2-256-ecc",
          "schema": "discovery"
        },
        "encryption-context": {},
        "reproduced-encryption-context": {}
      }
    },
  }
}
```
